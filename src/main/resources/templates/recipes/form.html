<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${recipe.id != null} ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç' : '–î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç'"></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <nav class="navbar navbar-light bg-light mb-4">
        <a class="navbar-brand" href="/">üçΩÔ∏è –†–µ—Ü–µ–ø—Ç –¥–Ω—è</a>
        <a href="/recipes" class="btn btn-secondary">–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
    </nav>

    <div class="card">
        <div class="card-header" th:classappend="${recipe.id != null} ? 'bg-warning' : 'bg-primary'">
            <h4 class="card-title text-white">
                <span th:text="${recipe.id != null} ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç' : '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç'"></span>
            </h4>
        </div>
        
        <div class="card-body">
            <!-- –ò–∑–º–µ–Ω–∏—Ç–µ action –Ω–∞ "/recipes/save" -->
            <form th:action="@{/recipes/save}" th:object="${recipe}" method="post">
                <input type="hidden" th:field="*{id}">
                
                <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
                <div class="mb-3">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞ *</label>
                    <input type="text" class="form-control" th:field="*{title}" 
                           th:classappend="${#fields.hasErrors('title')} ? 'is-invalid' : ''"
                           required>
                    <div class="invalid-feedback" th:if="${#fields.hasErrors('title')}">
                        <span th:errors="*{title}"></span>
                    </div>
                </div>
                
                <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                <div class="mb-3">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea class="form-control" th:field="*{description}" rows="2"></textarea>
                    <div class="invalid-feedback" th:if="${#fields.hasErrors('description')}">
                        <span th:errors="*{description}"></span>
                    </div>
                </div>
                
                <div class="row">
                    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                        <select class="form-control" th:field="*{category}" required
                                th:classappend="${#fields.hasErrors('category')} ? 'is-invalid' : ''">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                            <option th:each="cat : ${categories}" 
                                    th:value="${cat.id}"
                                    th:text="${cat.title}"
                                    th:selected="${recipe.category != null and recipe.category.id == cat.id}">
                            </option>
                        </select>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('category')}">
                            <span th:errors="*{category}"></span>
                        </div>
                    </div>
                    
                    <!-- –í—Ä–µ–º—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è -->
                    <div class="col-md-3 mb-3">
                        <label class="form-label">–í—Ä–µ–º—è (–º–∏–Ω—É—Ç—ã) *</label>
                        <input type="number" class="form-control" th:field="*{preparationTime}" 
                               min="5" max="1440" required
                               th:classappend="${#fields.hasErrors('preparationTime')} ? 'is-invalid' : ''">
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('preparationTime')}">
                            <span th:errors="*{preparationTime}"></span>
                        </div>
                    </div>
                    
                    <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ä—Ü–∏–π -->
                    <div class="col-md-3 mb-3">
                        <label class="form-label">–ü–æ—Ä—Ü–∏–π *</label>
                        <input type="number" class="form-control" th:field="*{servings}" 
                               min="1" max="20" required
                               th:classappend="${#fields.hasErrors('servings')} ? 'is-invalid' : ''">
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('servings')}">
                            <span th:errors="*{servings}"></span>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <!-- –°–ª–æ–∂–Ω–æ—Å—Ç—å -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">–°–ª–æ–∂–Ω–æ—Å—Ç—å (1-5) *</label>
                        <input type="number" class="form-control" th:field="*{difficulty}" 
                               min="1" max="5" required
                               th:classappend="${#fields.hasErrors('difficulty')} ? 'is-invalid' : ''">
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('difficulty')}">
                            <span th:errors="*{difficulty}"></span>
                        </div>
                    </div>
                    
                    <!-- –†–µ–π—Ç–∏–Ω–≥ -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">–†–µ–π—Ç–∏–Ω–≥ (0.0-5.0)</label>
                        <input type="number" class="form-control" th:field="*{rating}" 
                               step="0.1" min="0" max="5"
                               th:classappend="${#fields.hasErrors('rating')} ? 'is-invalid' : ''">
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('rating')}">
                            <span th:errors="*{rating}"></span>
                        </div>
                    </div>
                </div>
                
                <!-- –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã -->
                <div class="mb-3">
                    <label class="form-label">–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã *</label>
                    <textarea class="form-control" th:field="*{ingredients}" 
                              rows="4" 
                              placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã, –∫–∞–∂–¥—ã–π —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏" 
                              required
                              th:classappend="${#fields.hasErrors('ingredients')} ? 'is-invalid' : ''"></textarea>
                    <small class="text-muted">–ö–∞–∂–¥—ã–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏</small>
                    <div class="invalid-feedback" th:if="${#fields.hasErrors('ingredients')}">
                        <span th:errors="*{ingredients}"></span>
                    </div>
                </div>
                
                <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
                <div class="mb-3">
                    <label class="form-label">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è *</label>
                    <textarea class="form-control" th:field="*{instructions}" 
                              rows="6" 
                              placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—à–∏—Ç–µ —à–∞–≥–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è" 
                              required
                              th:classappend="${#fields.hasErrors('instructions')} ? 'is-invalid' : ''"></textarea>
                    <div class="invalid-feedback" th:if="${#fields.hasErrors('instructions')}">
                        <span th:errors="*{instructions}"></span>
                    </div>
                </div>
                
                <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö -->
                <div th:if="${#fields.hasErrors('*')}">
                    <div class="alert alert-danger">
                        <h6>–ò—Å–ø—Ä–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –æ—à–∏–±–∫–∏:</h6>
                        <ul>
                            <li th:each="err : ${#fields.errors('*')}" th:text="${err}"></li>
                        </ul>
                    </div>
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∏ -->
                <div class="d-flex justify-content-between">
                    <a href="/recipes" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
                    <button type="submit" class="btn btn-primary">
                        <span th:text="${recipe.id != null} ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è' : '–î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç'"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø—Ä–∏–≤—è–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤—ã–±—Ä–∞–Ω–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
    var categorySelect = document.querySelector('select[th\\:field="*{category}"]');
    if (categorySelect) {
        // Thymeleaf —É–∂–µ –¥–æ–ª–∂–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å selected option —á–µ—Ä–µ–∑ th:selected
        console.log('Category select initialized');
    }
});
</script>
</body>
</html>
